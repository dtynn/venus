# 重构日记

- [ ] 关于 venus-devtool 部分，也就是开发过程中需要用到的各类辅助工具放置位置：从现在来看，以一个单独的、内部的 module 模式比较好，可以避免在 venus/v2 中显式声明对新的 module 进行 replace，从而也就避免了出现依赖关系上的“难以厘清”。

- [ ] 在抽取 `chain.BlockHeader` 的过程中，出现了同样的序列化过程反复手写， `cachedBytes` 与 `cachedCid` 用上了又没完全用上的情况，这个应该是在处理历史遗留问题时追求“快速实现”的结果。同时，在写好实现之后立刻进行基本的测试编写帮助找出了 `SignatureData` 方法中，由于结构体复制后没有清除 cache 导致的bug。

    由此可见，测试用例，尤其是基础功能性的测试用例，应当在逻辑代码实现后立即着手编写，这样做一方面是可以尽快找出问题，避免系统复杂之后更为困难的 debug 过程；另一方面则是可以趁着记忆仍然“新鲜”，保障有一个较好的测试覆盖率。
